<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>逆水前行</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="逆水前行">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="逆水前行">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="karidyang">
<meta name="twitter:card" content="summary">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    
  
  
<link rel="stylesheet" href="/css/style.css">

  

<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    
    <div id="header-inner" class="inner">
      <nav id="sub-nav">
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">首页</a>
        
          <a class="main-nav-link" href="/archives">归档</a>
        
          <a class="main-nav-link" href="/about">关于</a>
        
      </nav>
      
    </div>
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">逆水前行</a>
      </h1>
      
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-Spock实践" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/02/11/Spock%E5%AE%9E%E8%B7%B5/" class="article-date">
  <time datetime="2022-02-11T09:55:47.000Z" itemprop="datePublished">2022-02-11</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2022/02/11/Spock%E5%AE%9E%E8%B7%B5/">Spock实践</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- Table of Contents -->
        
        <h2 id="Spock是什么？"><a href="#Spock是什么？" class="headerlink" title="Spock是什么？"></a>Spock是什么？</h2><p>Spock是一款国外优秀的测试框架，基于<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Behavior-driven_development">BDD</a>（行为驱动开发）思想实现，功能非常强大。Spock结合Groovy动态语言的特点，提供了各种标签，并采用简单、通用、结构化的描述语言，让编写测试代码更加简洁、高效。<a target="_blank" rel="noopener" href="https://spockframework.org/">官方的介绍</a>如下：</p>
<p><img src="https://p0.meituan.net/travelcube/4403846a46a805b9cf304187317da94a52377.png" alt="img"></p>
<blockquote>
<p>What is it? Spock is a testing and specification framework for Java and Groovy applications. What makes it stand out from the crowd is its beautiful and highly expressive specification language. Thanks to its JUnit runner, Spock is compatible with most IDEs, build tools, and continuous integration servers. Spock is inspired from JUnit, RSpec, jMock, Mockito, Groovy, Scala, Vulcans, and other fascinating life forms.</p>
</blockquote>
<p>Spock是一个Java和Groovy`应用的测试和规范框架。之所以能够在众多测试框架中脱颖而出，是因为它优美而富有表现力的规范语言。Spock的灵感来自JUnit、RSpec、jMock、Mockito、Groovy、Scala、Vulcans。</p>
<p>简单来讲，Spock主要特点如下：</p>
<ul>
<li>让测试代码更规范，内置多种标签来规范单元测试代码的语义，测试代码结构清晰，更具可读性，降低后期维护难度。</li>
<li>提供多种标签，比如：<code>given</code>、<code>when</code>、<code>then</code>、<code>expect</code>、<code>where</code>、<code>with</code>、<code>thrown</code>……帮助我们应对复杂的测试场景。</li>
<li>使用Groovy这种动态语言来编写测试代码，可以让我们编写的测试代码更简洁，适合敏捷开发，提高编写单元测试代码的效率。</li>
<li>遵从<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Behavior-driven_development">BDD</a>（行为驱动开发）模式，有助于提升代码的质量。</li>
<li>IDE兼容性好，自带Mock功能。</li>
</ul>
<p>笔者以前实践过PowerMock、Mockito，比原来的Junit好多了，但是现在都是使用的SpringBoot开发项目，大部分的类都是Spring的Bean，使用PowerMock对类Mock并不是很好用，测试起来也算是很麻烦了，那么Spock真的好用吗？</p>
<p>笔者从美团的技术博客上了解到<a href="#%5BSpock%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E6%A1%86%E6%9E%B6%E4%BB%8B%E7%BB%8D%E4%BB%A5%E5%8F%8A%E5%9C%A8%E7%BE%8E%E5%9B%A2%E4%BC%98%E9%80%89%E7%9A%84%E5%AE%9E%E8%B7%B5%5D(https://tech.meituan.com/2021/08/06/spock-practice-in-meituan.html)">Spock的实际使用</a>,因此在团队中，我也实践了一把。基本的使用方法，美团的技术文章已经讲的很明白了，那我就讲点不一样的。</p>
<h2 id="基于Gradle的项目配置"><a href="#基于Gradle的项目配置" class="headerlink" title="基于Gradle的项目配置"></a>基于Gradle的项目配置</h2><p>基于kotlin的Gradle配置build.gradle.kts</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">plugins &#123;</span><br><span class="line">  <span class="comment">//引入gradle的Groovy插件</span></span><br><span class="line">	groovy</span><br><span class="line">  <span class="comment">//使用jacoco生成测试报告</span></span><br><span class="line">  jacoco</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">val</span> spockVersion = <span class="string">&quot;2.0-groovy-2.5&quot;</span></span><br><span class="line">project &#123;</span><br><span class="line">  apply(plugin = <span class="string">&quot;groovy&quot;</span>)</span><br><span class="line">  apply(plugin = <span class="string">&quot;jacoco&quot;</span>)</span><br><span class="line">  </span><br><span class="line">  dependencies &#123;</span><br><span class="line">    </span><br><span class="line">  	testImplementation(<span class="string">&quot;org.codehaus.groovy:groovy:2.5.9&quot;</span>)</span><br><span class="line">    testImplementation(<span class="string">&quot;org.jetbrains.kotlin:kotlin-test-junit5&quot;</span>)</span><br><span class="line">    testImplementation(<span class="string">&quot;junit:junit&quot;</span>)</span><br><span class="line">    testImplementation(<span class="string">&quot;org.springframework.boot:spring-boot-starter-test&quot;</span>) &#123;</span><br><span class="line">       exclude(group = <span class="string">&quot;org.junit.vintage&quot;</span>, module = <span class="string">&quot;junit-vintage-engine&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    testImplementation(<span class="string">&quot;org.spockframework:spock-core:<span class="variable">$spockVersion</span>&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//配置测试源代码目录加上groovy的</span></span><br><span class="line">  sourceSets &#123;</span><br><span class="line"></span><br><span class="line">        test &#123;</span><br><span class="line">            java &#123;srcDirs(<span class="string">&quot;src/test/java&quot;</span>, <span class="string">&quot;src/test/groovy&quot;</span>)&#125;</span><br><span class="line">            resources &#123; srcDir(<span class="string">&quot;src/test/resources&quot;</span>) &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="comment">//配置jacoco</span></span><br><span class="line">    tasks.test &#123;</span><br><span class="line">        finalizedBy(tasks.jacocoTestReport)</span><br><span class="line">    &#125;</span><br><span class="line">    tasks.jacocoTestReport &#123;</span><br><span class="line">        dependsOn(tasks.test)</span><br><span class="line">    &#125;</span><br><span class="line">    tasks.withType&lt;Test&gt; &#123;</span><br><span class="line">        useJUnitPlatform()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="Mock模拟"><a href="#Mock模拟" class="headerlink" title="Mock模拟"></a>Mock模拟</h2><p>我们的项目现在使用的是Kotlin，Kotlin的类默认是final的，Mock时需要修改类为open，比如</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但是如果标记了Spring的Bean注解（@Service@Repository@Component)等，其实是默认已经修改过了，不需要额外去标记。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FinLogisticsDeductionSpec</span> <span class="title">extends</span> <span class="title">Specification</span> </span>&#123;</span><br><span class="line">    def finLogisticsAccountService = Mock(FinLogisticsAccountService.<span class="keyword">class</span>)</span><br><span class="line">    def finLogisticsDeduction  = new FinLogisticsDeductionAdvanceImpl(finLogisticsAccountService: finLogisticsAccountService)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    def <span class="string">&quot;测试 消费&quot;</span>() &#123;</span><br><span class="line">        def req = new FinLogisticsDeductionExecBO(amount: new BigDecimal(<span class="number">100</span>))</span><br><span class="line">        given: <span class="string">&quot;设置消费现金100&quot;</span></span><br><span class="line">        def cash = new BigDecimal(<span class="number">100</span>)</span><br><span class="line"></span><br><span class="line">        and: <span class="string">&quot;扣费服务返回扣费现金100&quot;</span></span><br><span class="line">        finLogisticsAccountService.deduction(req, LogisticsAccountType.ADVANCE) &gt;&gt; cash</span><br><span class="line"></span><br><span class="line">        <span class="keyword">when</span>: <span class="string">&quot;扣费&quot;</span></span><br><span class="line">        def result = finLogisticsDeduction.exec(req)</span><br><span class="line"></span><br><span class="line">        then: <span class="string">&quot;期望结果&quot;</span></span><br><span class="line">        with(result) &#123;</span><br><span class="line">            it == cash</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="多分支条件测试"><a href="#多分支条件测试" class="headerlink" title="多分支条件测试"></a>多分支条件测试</h2><p>项目中经常会遇到同一个方法里面有多个if-else分支的情况，通过Spock的where标签可以非常容易的实现这个。方法名中的#amount，是直接在字符串模板中显示变量的值，可以更直观的显示在测试结果中。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Unroll</span></span><br><span class="line">def <span class="string">&quot;扣费:#amount 当用户现金是:#account.availableCashAmount,红包是:#account.availableAwardAmount, 扣费后现金余额:#cash, 红包余额:#award, 返回剩余金额:#expectResult &quot;</span>() &#123;</span><br><span class="line">    given:</span><br><span class="line">    def bo = new FinLogisticsDeductionExecBO(amount: amount, fromCompanyId: <span class="number">1</span>, comment: <span class="string">&quot;订单扣费&quot;</span>, deductedAfterRecharge: deductedAfterRecharge, billId: <span class="number">1</span>, billNo: <span class="string">&quot;1234546&quot;</span>)</span><br><span class="line">    and:</span><br><span class="line">    finLogisticsAccountItemRepository.selectUnusedList(account.id, <span class="literal">false</span>) &gt;&gt; accountItems</span><br><span class="line">    securityUtils.currentUser() &gt;&gt; currentUser</span><br><span class="line">    finLogisticsAccountItemRepository.updateById(_ <span class="keyword">as</span> FinLogisticsAccountItemEntity) &gt;&gt; <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">when</span>: <span class="string">&quot;扣现金&quot;</span></span><br><span class="line">    def result = tester.loopDeduction(account, bo)</span><br><span class="line"></span><br><span class="line">    then:</span><br><span class="line">    with(result) &#123;</span><br><span class="line">        expectResult == it</span><br><span class="line">        accountItems[<span class="number">0</span>].availableCashBalance == cash</span><br><span class="line">        accountItems[<span class="number">0</span>].availableAwardBalance == award</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">where</span>: <span class="string">&quot;验证分支&quot;</span></span><br><span class="line">    amount | currentUser     | account                | accountItems                | deductedAfterRecharge || cash | award | expectResult</span><br><span class="line">    <span class="number">10000</span>  | currentUser()   | getAccount(<span class="number">10000</span>, <span class="number">0</span>)   | getAccountItems(<span class="number">10000</span>, <span class="number">0</span>)   | <span class="literal">true</span>                   | <span class="number">0</span>    | <span class="number">0</span>     | <span class="number">0</span></span><br><span class="line">    <span class="number">10000</span>  | currentUser()   | getAccount(<span class="number">0</span>, <span class="number">10000</span>)   | getAccountItems(<span class="number">0</span>, <span class="number">10000</span>)   | <span class="literal">true</span>                   | <span class="number">0</span>    | <span class="number">0</span>     | <span class="number">0</span></span><br><span class="line">    <span class="number">10000</span>  | currentUser()   | getAccount(<span class="number">5000</span>, <span class="number">5000</span>) | getAccountItems(<span class="number">5000</span>, <span class="number">5000</span>) | <span class="literal">true</span>                   | <span class="number">0</span>    | <span class="number">0</span>     | <span class="number">0</span></span><br><span class="line">    <span class="number">10000</span>  | currentUser()   | getAccount(<span class="number">4000</span>, <span class="number">5000</span>) | getAccountItems(<span class="number">4000</span>, <span class="number">5000</span>) | <span class="literal">true</span>                   | <span class="number">0</span>    | <span class="number">0</span>     | <span class="number">1000</span></span><br><span class="line">    <span class="number">10000</span>  | currentUser()   | getAccount(<span class="number">6000</span>, <span class="number">5000</span>) | getAccountItems(<span class="number">6000</span>, <span class="number">5000</span>) | <span class="literal">true</span>                   | <span class="number">0</span>    | <span class="number">1000</span>  | <span class="number">0</span></span><br><span class="line">    <span class="number">10000</span>  | currentUser()   | getAccount(<span class="number">10000</span>, <span class="number">0</span>)   | getAccountItems(<span class="number">10000</span>, <span class="number">0</span>)   | <span class="literal">false</span>                  | <span class="number">0</span>    | <span class="number">0</span>     | <span class="number">0</span></span><br><span class="line">    <span class="number">10000</span>  | currentUser()   | getAccount(<span class="number">0</span>, <span class="number">10000</span>)   | getAccountItems(<span class="number">0</span>, <span class="number">10000</span>)   | <span class="literal">false</span>                  | <span class="number">0</span>    | <span class="number">0</span>     | <span class="number">0</span></span><br><span class="line">    <span class="number">10000</span>  | currentUser()   | getAccount(<span class="number">5000</span>, <span class="number">5000</span>) | getAccountItems(<span class="number">5000</span>, <span class="number">5000</span>) | <span class="literal">false</span>                  | <span class="number">0</span>    | <span class="number">0</span>     | <span class="number">0</span></span><br><span class="line">    <span class="number">10000</span>  | new AuditData() | getAccount(<span class="number">4000</span>, <span class="number">5000</span>) | getAccountItems(<span class="number">4000</span>, <span class="number">5000</span>) | <span class="literal">false</span>                  | <span class="number">0</span>    | <span class="number">0</span>     | <span class="number">1000</span></span><br><span class="line">    <span class="number">10000</span>  | new AuditData() | getAccount(<span class="number">6000</span>, <span class="number">5000</span>) | getAccountItems(<span class="number">6000</span>, <span class="number">5000</span>) | <span class="literal">false</span>                  | <span class="number">0</span>    | <span class="number">1000</span>  | <span class="number">0</span></span><br><span class="line">    <span class="number">0</span>      | <span class="literal">null</span>            | getAccount(<span class="number">6000</span>, <span class="number">5000</span>) | getAccountItems(<span class="number">6000</span>, <span class="number">5000</span>) | <span class="literal">true</span>                   | <span class="number">6000</span> | <span class="number">5000</span>  | <span class="number">0</span></span><br><span class="line">    <span class="number">0</span>      | <span class="literal">null</span>            | getAccount(<span class="number">6000</span>, <span class="number">5000</span>) | getAccountItems(<span class="number">6000</span>, <span class="number">5000</span>) | <span class="literal">false</span>                  | <span class="number">6000</span> | <span class="number">5000</span>  | <span class="number">0</span></span><br><span class="line">    <span class="number">100</span>    | <span class="literal">null</span>            | getAccount(<span class="number">0</span>, <span class="number">0</span>)       | getAccountItems(<span class="number">0</span>, <span class="number">0</span>)       | <span class="literal">false</span>                  | <span class="number">0</span>    | <span class="number">0</span>     | <span class="number">100</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://blog-img.taoguli.com/img/image-20220211215607514.png" alt="image-20220211215607514"></p>
<h2 id="异常测试"><a href="#异常测试" class="headerlink" title="异常测试"></a>异常测试</h2><p>对于方法逻辑中会抛出异常的逻辑，可以通过thrown(异常变量)方法来获取异常错误，比如：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Unroll</span></span><br><span class="line">    def <span class="string">&quot;测试退款现金不足 #expectedMessage&quot;</span>() &#123;</span><br><span class="line">        given:</span><br><span class="line">        def bo = new FinLogisticsRefundExecBO(cashAmount: cashAmount, awardAmount: awardAmount, fromCompanyId: <span class="number">1</span>, comment: <span class="string">&quot;订单扣费&quot;</span>, billId: <span class="number">1</span>, billNo: <span class="string">&quot;1234546&quot;</span>)</span><br><span class="line">        def account = new FinLogisticsAccountEntity(id: <span class="number">1</span>)</span><br><span class="line">        and:</span><br><span class="line">        finLogisticsAccountItemRepository.selectUnusedList(account.id, <span class="literal">false</span>) &gt;&gt; accountItems</span><br><span class="line">        securityUtils.currentUser() &gt;&gt; currentUser</span><br><span class="line"></span><br><span class="line">        <span class="keyword">when</span>:</span><br><span class="line">        tester.loopRefund(account, bo)</span><br><span class="line">        then:</span><br><span class="line">        def exception = thrown(expectedException)</span><br><span class="line">        exception.message == expectedMessage</span><br><span class="line"></span><br><span class="line">        <span class="keyword">where</span>: <span class="string">&quot;验证分支&quot;</span></span><br><span class="line">        cashAmount | awardAmount | currentUser   | accountItems                  || expectedException | expectedMessage</span><br><span class="line">        <span class="number">20000</span>      | <span class="number">0</span>           | currentUser() | getAccountItems(<span class="number">10000</span>, <span class="number">0</span>)     || BaseException     | <span class="string">&quot;退款出错，现金金额不能大于账户现金余额&quot;</span></span><br><span class="line">        <span class="number">20000</span>      | <span class="number">0</span>           | currentUser() | getAccountItems(<span class="number">0</span>, <span class="number">0</span>)         || BaseException     | <span class="string">&quot;退款出错，现金金额不能大于账户现金余额&quot;</span></span><br><span class="line">        <span class="number">0</span>          | <span class="number">20000</span>       | currentUser() | getAccountItems(<span class="number">0</span>, <span class="number">10000</span>)     || BaseException     | <span class="string">&quot;退款出错，红包金额不能大于账户红包余额&quot;</span></span><br><span class="line">        <span class="number">10000</span>      | <span class="number">11000</span>       | currentUser() | getAccountItems(<span class="number">10000</span>, <span class="number">10000</span>) || BaseException     | <span class="string">&quot;退款出错，红包金额不能大于账户红包余额&quot;</span></span><br><span class="line">        <span class="number">0</span>          | <span class="number">100</span>         | currentUser() | getAccountItems(<span class="number">0</span>, <span class="number">0</span>)         || BaseException     | <span class="string">&quot;退款出错，红包金额不能大于账户红包余额&quot;</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/02/11/Spock%E5%AE%9E%E8%B7%B5/" data-id="ckzihch2a000m939k39dp9qit" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java-Spock/" rel="tag">Java,Spock</a></li></ul>

    </footer>
  </div>
  
</article>
 


  
    <article id="post-uni-app-包装H5项目集成微信登录支付和分享" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/04/23/uni-app-%E5%8C%85%E8%A3%85H5%E9%A1%B9%E7%9B%AE%E9%9B%86%E6%88%90%E5%BE%AE%E4%BF%A1%E7%99%BB%E5%BD%95%E6%94%AF%E4%BB%98%E5%92%8C%E5%88%86%E4%BA%AB/" class="article-date">
  <time datetime="2021-04-23T06:22:11.000Z" itemprop="datePublished">2021-04-23</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/04/23/uni-app-%E5%8C%85%E8%A3%85H5%E9%A1%B9%E7%9B%AE%E9%9B%86%E6%88%90%E5%BE%AE%E4%BF%A1%E7%99%BB%E5%BD%95%E6%94%AF%E4%BB%98%E5%92%8C%E5%88%86%E4%BA%AB/">uni-app 包装H5项目集成微信登录支付和分享</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- Table of Contents -->
        
        <h2 id="引用UNI-APP的JS"><a href="#引用UNI-APP的JS" class="headerlink" title="引用UNI-APP的JS"></a>引用UNI-APP的JS</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line"><span class="keyword">var</span> userAgent = navigator.userAgent;</span><br><span class="line"><span class="keyword">if</span> (userAgent.indexOf(<span class="string">&#x27;AlipayClient&#x27;</span>) &gt; -<span class="number">1</span>) &#123;</span><br><span class="line"><span class="comment">// 支付宝小程序的 JS-SDK 防止 404 需要动态加载，如果不需要兼容支付宝小程序，则无需引用此 JS 文件。</span></span><br><span class="line"><span class="built_in">document</span>.writeln(<span class="string">&#x27;&lt;script src=&quot;https://appx/web-view.min.js&quot;&#x27;</span> + <span class="string">&#x27;&gt;&#x27;</span> + <span class="string">&#x27;&lt;&#x27;</span> + <span class="string">&#x27;/&#x27;</span> + <span class="string">&#x27;script&gt;&#x27;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="regexp">/QQ/i</span>.test(userAgent) &amp;&amp; <span class="regexp">/miniProgram/i</span>.test(userAgent)) &#123;</span><br><span class="line"><span class="comment">// QQ 小程序</span></span><br><span class="line"><span class="built_in">document</span>.write(<span class="string">&#x27;&lt;script type=&quot;text/javascript&quot; src=&quot;https://qqq.gtimg.cn/miniprogram/webview_jssdk/qqjssdk-1.0.0.js&quot;&gt;&lt;\/script&gt;&#x27;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="regexp">/miniProgram/i</span>.test(userAgent) &amp;&amp; <span class="regexp">/micromessenger/i</span>.test(userAgent)) &#123;</span><br><span class="line"><span class="comment">// 微信小程序 JS-SDK 如果不需要兼容微信小程序，则无需引用此 JS 文件。</span></span><br><span class="line"><span class="built_in">document</span>.write(<span class="string">&#x27;&lt;script type=&quot;text/javascript&quot; src=&quot;https://res.wx.qq.com/open/js/jweixin-1.4.0.js&quot;&gt;&lt;\/script&gt;&#x27;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="regexp">/toutiaomicroapp/i</span>.test(userAgent)) &#123;</span><br><span class="line"><span class="comment">// 头条小程序 JS-SDK 如果不需要兼容头条小程序，则无需引用此 JS 文件。</span></span><br><span class="line"><span class="built_in">document</span>.write(<span class="string">&#x27;&lt;script type=&quot;text/javascript&quot; src=&quot;https://s3.pstatp.com/toutiao/tmajssdk/jssdk-1.0.1.js&quot;&gt;&lt;\/script&gt;&#x27;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="regexp">/swan/i</span>.test(userAgent)) &#123;</span><br><span class="line"><span class="comment">// 百度小程序 JS-SDK 如果不需要兼容百度小程序，则无需引用此 JS 文件。</span></span><br><span class="line"><span class="built_in">document</span>.write(<span class="string">&#x27;&lt;script type=&quot;text/javascript&quot; src=&quot;https://b.bdstatic.com/searchbox/icms/searchbox/js/swan-2.0.18.js&quot;&gt;&lt;\/script&gt;&#x27;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="regexp">/quickapp/i</span>.test(userAgent)) &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// quickapp</span></span><br><span class="line"><span class="built_in">document</span>.write(<span class="string">&#x27;&lt;script type=&quot;text/javascript&quot; src=&quot;https://quickapp/jssdk.webview.min.js&quot;&gt;&lt;\/script&gt;&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (!<span class="regexp">/toutiaomicroapp/i</span>.test(userAgent)) &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">document</span>.querySelector(<span class="string">&#x27;.post-message-section&#x27;</span>).style.visibility = <span class="string">&#x27;visible&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;!-- uni 的 SDK --&gt;</span><br><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span> src=<span class="string">&quot;https://js.cdn.aliyun.dcloud.net.cn/dev/uni-app/uni.webview.1.5.2.js&quot;</span>&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h2 id="登录，接收回调参数"><a href="#登录，接收回调参数" class="headerlink" title="登录，接收回调参数"></a>登录，接收回调参数</h2><blockquote>
<p>userInof 是登录后json序列化编码后的字符串</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;m.zhcn.qfdenge.com&#x2F;uc&#x2F;login?userInfo&#x3D;$&#123;userInfo&#125;</span><br></pre></td></tr></table></figure>

<h2 id="支付"><a href="#支付" class="headerlink" title="支付"></a>支付</h2><p>使用uni.requestPayment，参考 <a target="_blank" rel="noopener" href="https://uniapp.dcloud.io/api/plugins/payment?id=requestpayment">https://uniapp.dcloud.io/api/plugins/payment?id=requestpayment</a></p>
<p>其中的orderInfo的格式如下</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="attr">&quot;appid&quot;</span>: <span class="string">&quot;wx0411fa6a39d61297”, </span></span><br><span class="line"><span class="string">&quot;</span>noncestr<span class="string">&quot;: &quot;</span><span class="number">5</span>JigiIJicbq8hQI2”, </span><br><span class="line"><span class="attr">&quot;package&quot;</span>: <span class="string">&quot;Sign=WXPay”, </span></span><br><span class="line"><span class="string">&quot;</span>partnerid<span class="string">&quot;: &quot;</span><span class="number">1230636401</span>”, </span><br><span class="line"><span class="attr">&quot;prepayid&quot;</span>: <span class="string">&quot;wx21204902147233e222e12d451613768000”, </span></span><br><span class="line"><span class="string">&quot;</span>timestamp<span class="string">&quot;: 1571662142, </span></span><br><span class="line"><span class="string">&quot;</span>sign<span class="string">&quot;: “0E5C9B9B1C8D7497A234CCC3C721AB1F&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>HTML页面需要传递过来的是</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="attr">&quot;appId&quot;</span>: <span class="string">&quot;wxf09c6920dc0f2230&quot;</span>,</span><br><span class="line"><span class="attr">&quot;partnerId&quot;</span>: <span class="string">&quot;1429576202&quot;</span>,</span><br><span class="line"><span class="attr">&quot;prepayId&quot;</span>: <span class="string">&quot;wx111943147461245fa3922a787fc7260000&quot;</span>,</span><br><span class="line"><span class="attr">&quot;packageValue&quot;</span>: <span class="string">&quot;Sign=WXPay&quot;</span>,</span><br><span class="line"><span class="attr">&quot;noncestr&quot;</span>: <span class="string">&quot;c71PJL2Q9AbuPd7gskqWORr3FoNYDSRA&quot;</span>,</span><br><span class="line"><span class="attr">&quot;timestamp&quot;</span>: <span class="string">&quot;1599824594&quot;</span>,</span><br><span class="line"><span class="attr">&quot;sign&quot;</span>: <span class="string">&quot;86F8C4EC4E8662CBD2DB3C0EC5D82557&quot;</span>,</span><br><span class="line"><span class="attr">&quot;orderNo&quot;</span>: <span class="string">&quot;21812009111551972&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!<span class="regexp">/toutiaomicroapp/i</span>.test(userAgent)) &#123;</span><br><span class="line">    <span class="keyword">var</span> orderInfo = <span class="built_in">encodeURIComponent</span>(<span class="built_in">JSON</span>.stringify(result.data));</span><br><span class="line">    uni.navigateTo(&#123;</span><br><span class="line">        url: <span class="string">&quot;/pages/pay/pay?orderInfo=&quot;</span>+orderInfo</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">//弹出待查询界面</span></span><br><span class="line">    $.pay(<span class="string">&quot;&quot;</span>, &#123;</span><br><span class="line">        buttonHandler: <span class="function"><span class="keyword">function</span> (<span class="params">layer</span>) </span>&#123;</span><br><span class="line">            submitCheckOrder(orderId, layer);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="分享"><a href="#分享" class="headerlink" title="分享"></a>分享</h2><p>添加按钮点击事件，向uni传递消息数据</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!<span class="regexp">/toutiaomicroapp/i</span>.test(userAgent)) &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="built_in">document</span>.addEventListener(<span class="string">&#x27;UniAppJSBridgeReady&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">document</span>.getElementById(<span class="string">&quot;btn_share&quot;</span>).addEventListener(<span class="string">&#x27;click&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">evt</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> shareUrl = shareData.url;</span><br><span class="line">            <span class="keyword">if</span> (-<span class="number">1</span> == shareUrl.indexOf(<span class="string">&#x27;back=share&#x27;</span>))&#123;</span><br><span class="line">                shareUrl += (-<span class="number">1</span> == shareUrl.indexOf(<span class="string">&#x27;?&#x27;</span>) ? <span class="string">&#x27;?&#x27;</span> : <span class="string">&#x27;&amp;&#x27;</span>) + <span class="string">&#x27;back=share&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            uni.postMessage(&#123;</span><br><span class="line">                data: &#123;</span><br><span class="line">                    title: shareData.title,</span><br><span class="line">                    desc: shareData.desc,</span><br><span class="line">                    link: shareUrl,</span><br><span class="line">                    imgUrl: shareData.icon,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>如此,就完成了UNI-APP集成微信登录\支付\分享的功能</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/04/23/uni-app-%E5%8C%85%E8%A3%85H5%E9%A1%B9%E7%9B%AE%E9%9B%86%E6%88%90%E5%BE%AE%E4%BF%A1%E7%99%BB%E5%BD%95%E6%94%AF%E4%BB%98%E5%92%8C%E5%88%86%E4%BA%AB/" data-id="ckzihch2c000r939kce6r8tx1" class="article-share-link">分享</a>
      
      
      
    </footer>
  </div>
  
</article>
 


  
    <article id="post-SpringCloud-Gateway-nacos-sentinel入门" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/04/23/SpringCloud-Gateway-nacos-sentinel%E5%85%A5%E9%97%A8/" class="article-date">
  <time datetime="2021-04-23T06:13:49.000Z" itemprop="datePublished">2021-04-23</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/04/23/SpringCloud-Gateway-nacos-sentinel%E5%85%A5%E9%97%A8/">SpringCloud+Gateway+nacos+sentinel入门</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- Table of Contents -->
        
        <h2 id="nacos的安装"><a href="#nacos的安装" class="headerlink" title="nacos的安装"></a>nacos的安装</h2><p>从官方网站（<a target="_blank" rel="noopener" href="https://github.com/alibaba/nacos/releases)%E4%B8%8B%E8%BD%BD%E7%A8%B3%E5%AE%9A%E7%89%881.3.2">https://github.com/alibaba/nacos/releases)下载稳定版1.3.2</a></p>
<p>以单机模式启动nacos</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin&#x2F;nacos -m standalone</span><br></pre></td></tr></table></figure>

<h2 id="创建2个工程"><a href="#创建2个工程" class="headerlink" title="创建2个工程"></a>创建2个工程</h2><p>spring-nacos-provider, spring-nacos-gateway</p>
<h3 id="spring-nacos-provider"><a href="#spring-nacos-provider" class="headerlink" title="spring-nacos-provider"></a>spring-nacos-provider</h3><ol>
<li>在pom.xml中添加依赖项</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>



<ol start="2">
<li>添加配置文件bootstrap.properties</li>
</ol>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Nacos帮助文档: https://nacos.io/zh-cn/docs/concepts.html</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Nacos认证信息</span></span><br><span class="line"></span><br><span class="line"><span class="meta">spring.cloud.nacos.config.username</span>=<span class="string">nacos</span></span><br><span class="line"></span><br><span class="line"><span class="meta">spring.cloud.nacos.config.password</span>=<span class="string">nacos</span></span><br><span class="line"></span><br><span class="line"><span class="meta">spring.cloud.nacos.config.contextPath</span>=<span class="string">/nacos</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置配置中心服务端地址</span></span><br><span class="line"></span><br><span class="line"><span class="meta">spring.cloud.nacos.config.server-addr</span>=<span class="string">127.0.0.1:8848</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Nacos 配置中心的namespace，默认为 public</span></span><br><span class="line"></span><br><span class="line"><span class="meta">spring.cloud.nacos.config.namespace</span>=<span class="string">public</span></span><br><span class="line"></span><br><span class="line"><span class="meta">spring.cloud.nacos.config.file-extension</span>=<span class="string">yaml</span></span><br></pre></td></tr></table></figure>



<ol start="3">
<li>修改配置文件application.yml</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line"></span><br><span class="line">port: 8081</span><br><span class="line"></span><br><span class="line">spring:</span><br><span class="line"></span><br><span class="line">application:</span><br><span class="line"></span><br><span class="line">name: demo-service</span><br><span class="line"></span><br><span class="line">cloud:</span><br><span class="line"></span><br><span class="line">nacos:</span><br><span class="line"></span><br><span class="line">discovery:</span><br><span class="line"></span><br><span class="line">namespace: public</span><br><span class="line"></span><br><span class="line">password: nacos</span><br><span class="line"></span><br><span class="line">server-addr: 127.0.0.1:8848</span><br><span class="line"></span><br><span class="line">username: nacos</span><br></pre></td></tr></table></figure>



<ol start="4">
<li>添加一个HelloController</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@GetMapping(&quot;/foo&quot;)</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">foo</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  	<span class="keyword">return</span> <span class="string">&quot;hello &quot;</span>+ name;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ol start="5">
<li>启动项目后，访问<a target="_blank" rel="noopener" href="http://localhost:8081/foo?name=%E5%BC%A0%E4%B8%89%EF%BC%8C%E5%8F%AF%E4%BB%A5%E5%BE%97%E5%88%B0%E5%A6%82%E4%B8%8B%E5%9B%BE%E7%A4%BA">http://localhost:8081/foo?name=张三，可以得到如下图示</a></li>
</ol>
<p><img src="https://blog-img.taoguli.com/img/image-20210423141827576.png" alt="image-20210423141827576"></p>
<p>此时服务提供端已经配置好了</p>
<h3 id="spring-nacos-gateway"><a href="#spring-nacos-gateway" class="headerlink" title="spring-nacos-gateway"></a>spring-nacos-gateway</h3><ol>
<li>在pom.xml中添加如下依赖</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-gateway<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.72<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.csp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sentinel-spring-cloud-gateway-adapter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.8.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-sentinel<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-alibaba-sentinel-datasource<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>





<ol start="2">
<li>添加配置文件bootstrap.properties</li>
</ol>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Nacos帮助文档: https://nacos.io/zh-cn/docs/concepts.html</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Nacos认证信息</span></span><br><span class="line"></span><br><span class="line"><span class="meta">spring.cloud.nacos.config.username</span>=<span class="string">nacos</span></span><br><span class="line"></span><br><span class="line"><span class="meta">spring.cloud.nacos.config.password</span>=<span class="string">nacos</span></span><br><span class="line"></span><br><span class="line"><span class="meta">spring.cloud.nacos.config.contextPath</span>=<span class="string">/nacos</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置配置中心服务端地址</span></span><br><span class="line"></span><br><span class="line"><span class="meta">spring.cloud.nacos.config.server-addr</span>=<span class="string">127.0.0.1:8848</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Nacos 配置中心的namespace，默认为 public</span></span><br><span class="line"></span><br><span class="line"><span class="meta">spring.cloud.nacos.config.namespace</span>=<span class="string">public</span></span><br><span class="line"></span><br><span class="line"><span class="meta">spring.cloud.nacos.config.file-extension</span>=<span class="string">yaml</span></span><br></pre></td></tr></table></figure>



<ol start="3">
<li>修改配置文件application.yml</li>
</ol>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server</span>:<span class="string"></span></span><br><span class="line"></span><br><span class="line"><span class="attr">port</span>: <span class="string">8080</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring</span>:<span class="string"></span></span><br><span class="line"></span><br><span class="line"><span class="attr">application</span>:<span class="string"></span></span><br><span class="line"></span><br><span class="line"><span class="attr">name</span>: <span class="string">gateway</span></span><br><span class="line"></span><br><span class="line"><span class="attr">cloud</span>:<span class="string"></span></span><br><span class="line"></span><br><span class="line"><span class="attr">nacos</span>:<span class="string"></span></span><br><span class="line"></span><br><span class="line"><span class="attr">discovery</span>:<span class="string"></span></span><br><span class="line"></span><br><span class="line"><span class="attr">namespace</span>: <span class="string">public</span></span><br><span class="line"></span><br><span class="line"><span class="attr">password</span>: <span class="string">nacos</span></span><br><span class="line"></span><br><span class="line"><span class="meta">server-addr</span>: <span class="string">127.0.0.1:8848</span></span><br><span class="line"></span><br><span class="line"><span class="attr">username</span>: <span class="string">nacos</span></span><br><span class="line"></span><br><span class="line"><span class="attr">gateway</span>:<span class="string"></span></span><br><span class="line"></span><br><span class="line"><span class="attr">discovery</span>:<span class="string"></span></span><br><span class="line"></span><br><span class="line"><span class="attr">locator</span>:<span class="string"></span></span><br><span class="line"></span><br><span class="line"><span class="attr">enabled</span>: <span class="string">true</span></span><br><span class="line"></span><br><span class="line"><span class="meta">lower-case-service-id</span>: <span class="string">true</span></span><br><span class="line"></span><br><span class="line"><span class="attr">routes</span>:<span class="string"></span></span><br><span class="line"></span><br><span class="line">	<span class="meta">-</span> <span class="string">id: spring-nacos-provider</span></span><br><span class="line"></span><br><span class="line">		<span class="attr">uri</span>: <span class="string">lb://spring-nacos-provider</span></span><br><span class="line"></span><br><span class="line">		<span class="attr">predicates</span>:<span class="string"></span></span><br><span class="line"></span><br><span class="line">	<span class="meta">-</span> <span class="string">Path=/provider/**</span></span><br><span class="line"></span><br><span class="line"><span class="attr">filters</span>:<span class="string"></span></span><br><span class="line"></span><br><span class="line">	<span class="meta">-</span> <span class="string">StripPrefix=1</span></span><br></pre></td></tr></table></figure>



<ol start="4">
<li>启动应用，访问<a target="_blank" rel="noopener" href="http://localhost:8080/provider/foo?name=%E5%BC%A0%E4%B8%89">http://localhost:8080/provider/foo?name=张三</a></li>
</ol>
<p><img src="https://blog-img.taoguli.com/img/image-20210423142014725.png" alt="image-20210423142014725"></p>
<p>完成网关接入。下面配合nacos，添加配置</p>
<p>在nacos中添加spring-nacos-provider.yaml的配置,注意选择类型为yaml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">didi:</span></span><br><span class="line"></span><br><span class="line">	<span class="attr">title:</span> <span class="string">&quot;架构师&quot;</span></span><br></pre></td></tr></table></figure>



<p>修改HelloController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Value(&quot;$&#123;didi.title&#125;&quot;)</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> String title;</span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">  <span class="meta">@GetMapping(&quot;/foo&quot;)</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">foo</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  	<span class="keyword">return</span> <span class="string">&quot;hello &quot;</span>+ name + <span class="string">&quot;, my title is &quot;</span> + title;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/04/23/SpringCloud-Gateway-nacos-sentinel%E5%85%A5%E9%97%A8/" data-id="ckzihch2c000q939k7wf571ho" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/spring-nacos-sentinel/" rel="tag">spring, nacos, sentinel</a></li></ul>

    </footer>
  </div>
  
</article>
 


  
    <article id="post-使用Ganache开发以太坊智能合约" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/04/23/%E4%BD%BF%E7%94%A8Ganache%E5%BC%80%E5%8F%91%E4%BB%A5%E5%A4%AA%E5%9D%8A%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/" class="article-date">
  <time datetime="2021-04-23T06:03:38.000Z" itemprop="datePublished">2021-04-23</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/04/23/%E4%BD%BF%E7%94%A8Ganache%E5%BC%80%E5%8F%91%E4%BB%A5%E5%A4%AA%E5%9D%8A%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/">使用Ganache开发以太坊智能合约</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- Table of Contents -->
        
        <h2 id="下载Ganache"><a href="#下载Ganache" class="headerlink" title="下载Ganache"></a>下载Ganache</h2><p><a target="_blank" rel="noopener" href="https://www.trufflesuite.com/ganache">下载地址</a></p>
<h2 id="安装Ganache"><a href="#安装Ganache" class="headerlink" title="安装Ganache"></a>安装Ganache</h2><p>略</p>
<h2 id="安装Metamask钱包"><a href="#安装Metamask钱包" class="headerlink" title="安装Metamask钱包"></a>安装Metamask钱包</h2><p>略,需要在Chrome中安装</p>
<h2 id="创建或者导入metamask钱包"><a href="#创建或者导入metamask钱包" class="headerlink" title="创建或者导入metamask钱包"></a>创建或者导入metamask钱包</h2><p>略</p>
<h2 id="开发"><a href="#开发" class="headerlink" title="开发"></a>开发</h2><h3 id="导入测试钱包"><a href="#导入测试钱包" class="headerlink" title="导入测试钱包"></a>导入测试钱包</h3><h4 id="在metamask钱包中添加自定义RPC链路"><a href="#在metamask钱包中添加自定义RPC链路" class="headerlink" title="在metamask钱包中添加自定义RPC链路"></a>在metamask钱包中添加自定义RPC链路</h4><p>选择自定义RPC<br><img src="https://blog-img.taoguli.com/img/image-20210423141024784.png" alt="image-20210423141024784"></p>
<p>填写网络名称\URL\链ID<br><img src="https://blog-img.taoguli.com/img/image-20210423141045865.png" alt="image-20210423141045865"></p>
<p>URL填写<a target="_blank" rel="noopener" href="http://127.0.0.1:7545/">http://127.0.0.1:7545</a></p>
<p>链ID填写0x1234</p>
<p>点击保存</p>
<h4 id="导入钱包"><a href="#导入钱包" class="headerlink" title="导入钱包"></a>导入钱包</h4><p>找到账号的私钥<br><img src="https://blog-img.taoguli.com/img/image-20210423141117898.png" alt="image-20210423141117898"></p>
<p><img src="https://blog-img.taoguli.com/img/image-20210423141131640.png" alt="image-20210423141131640"></p>
<p><img src="https://blog-img.taoguli.com/img/image-20210423141146283.png" alt="image-20210423141146283"></p>
<p>输入私钥</p>
<p><img src="https://blog-img.taoguli.com/img/image-20210423141156690.png" alt="image-20210423141156690"></p>
<h3 id="Dapp开发"><a href="#Dapp开发" class="headerlink" title="Dapp开发"></a>Dapp开发</h3><p><a target="_blank" rel="noopener" href="https://github.com/MetaMask/detect-provider">https://github.com/MetaMask/detect-provider</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.metamask.io/guide/ethereum-provider.html#using-the-provider">https://docs.metamask.io/guide/ethereum-provider.html#using-the-provider</a></p>
<p><a target="_blank" rel="noopener" href="https://eips.ethereum.org/EIPS/eip-20">https://eips.ethereum.org/EIPS/eip-20</a></p>
<p>币安接口 <a target="_blank" rel="noopener" href="https://binance-docs.github.io/apidocs/spot/cn/#45fa4e00db">https://binance-docs.github.io/apidocs/spot/cn/#45fa4e00db</a></p>
<h3 id="多签钱包"><a href="#多签钱包" class="headerlink" title="多签钱包"></a>多签钱包</h3><h4 id="ETH链的"><a href="#ETH链的" class="headerlink" title="ETH链的"></a>ETH链的</h4><p>ownbit</p>
<p>发布自己的ownbit多签钱包</p>
<p><a target="_blank" rel="noopener" href="https://ownbit.io/h5/app/prompt/pulish_ms_source_code_to_etherscan_zh.html">https://ownbit.io/h5/app/prompt/pulish_ms_source_code_to_etherscan_zh.html</a></p>
<p>技术分析<br><a target="_blank" rel="noopener" href="https://www.chainnews.com/articles/438767464709.htm">https://www.chainnews.com/articles/438767464709.htm</a></p>
<p><a target="_blank" rel="noopener" href="https://ownbit.io/">ownbit</a></p>
<h4 id="BSC链的"><a href="#BSC链的" class="headerlink" title="BSC链的"></a>BSC链的</h4><p><a target="_blank" rel="noopener" href="https://docs.binance.org/tss.html">https://docs.binance.org/tss.html</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.binance.org/smart-chain/developer/gnosis.html">https://docs.binance.org/smart-chain/developer/gnosis.html</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/04/23/%E4%BD%BF%E7%94%A8Ganache%E5%BC%80%E5%8F%91%E4%BB%A5%E5%A4%AA%E5%9D%8A%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/" data-id="ckzihch2d000u939k4fjvhvmj" class="article-share-link">分享</a>
      
      
      
    </footer>
  </div>
  
</article>
 


  
    <article id="post-2021学习计划" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/04/22/2021%E5%AD%A6%E4%B9%A0%E8%AE%A1%E5%88%92/" class="article-date">
  <time datetime="2021-04-22T08:27:09.000Z" itemprop="datePublished">2021-04-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/04/22/2021%E5%AD%A6%E4%B9%A0%E8%AE%A1%E5%88%92/">2021学习计划</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- Table of Contents -->
        
        <h2 id="管理"><a href="#管理" class="headerlink" title="管理"></a>管理</h2><ul>
<li>技术管理<ul>
<li>不断温习极客时间课程《技术管理实战36讲》</li>
</ul>
</li>
<li>OKR<ul>
<li>学习 《黄勇的OKR实战笔记》</li>
</ul>
</li>
</ul>
<h2 id="技术"><a href="#技术" class="headerlink" title="技术"></a>技术</h2><ul>
<li>Spring<ul>
<li>《小马哥讲Spring核心编程思想》</li>
<li>《小马哥讲Spring AOP编程思想》</li>
<li>《小马哥Java训练营》</li>
<li>《玩转Spring全家桶》</li>
</ul>
</li>
<li>ES<ul>
<li>《Elasticsearch核心技术与实战》</li>
</ul>
</li>
<li>K8S<ul>
<li>《深入剖析Kubernetes》</li>
<li><a target="_blank" rel="noopener" href="https://www.toutiao.com/i6935430385463542309/?wid=1619060049943">2021年Kubernetes架构师攻略</a></li>
</ul>
</li>
<li>架构<ul>
<li>《从0开始学架构》</li>
<li>《周志明的软件架构课》</li>
<li>《许式伟的架构课》</li>
<li>《十年架构感悟》</li>
<li>《DDD实战课》</li>
</ul>
</li>
<li>存储<ul>
<li>《后端存储实战课》</li>
<li>《消息队列高手课》</li>
<li>《MySQL实战45讲》</li>
<li>《Redis核心技术与实战》</li>
<li>《Kafka核心技术与实战》</li>
<li>《ZooKeeper实战与源码剖析》</li>
</ul>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/04/22/2021%E5%AD%A6%E4%B9%A0%E8%AE%A1%E5%88%92/" data-id="ckzihch29000k939k4ri9dni8" class="article-share-link">分享</a>
      
      
      
    </footer>
  </div>
  
</article>
 


  
    <article id="post-2016-02-26-learn-docker" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/02/26/2016-02-26-learn-docker/" class="article-date">
  <time datetime="2016-02-26T05:28:55.000Z" itemprop="datePublished">2016-02-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/02/26/2016-02-26-learn-docker/">学习Docker</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- Table of Contents -->
        
        <ol>
<li><p>Docker是什么<br> Docker是一个容器</p>
</li>
<li><p>Docker基本命令</p>
<ul>
<li>创建Ubuntu系统的容器 <code>docker run -it ubuntu:14.04 /bin/bash</code></li>
<li>查看当前所有容器 <code>docker ps -a </code></li>
<li>删除容器 <code>docker rm &#123;容器ID/名称&#125;</code></li>
<li>发布容器 <code>docker commit </code></li>
<li>绑定随机端口 <code>docker run -d -P --name &#123;容器名&#125; ubuntu:14.04 /bin/bash</code></li>
<li>绑定指定端口 <code>docker run -d -p &#123;本机ip&#125;:&#123;本机端口&#125;:&#123;容器端口&#125; --name &#123;容器名&#125; ubuntu:14.04 /bin/bash</code></li>
<li>挂载本机目录 <code>docker run -d -v `pwd`:/webapp ubuntu:14.04 /bin/bash</code></li>
</ul>
</li>
<li><p>Dockerfile</p>
<p> 使用Dockerfile可以比较方便的统一完成容器的搭建、配置工作<br> 一个比较完整的文件示例如下</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">#Version 1.0.1</span><br><span class="line">From ubuntu:14.04	#基本镜像</span><br><span class="line"></span><br><span class="line">MAINTAINER xxx &quot;xxx@xxx.xx&quot; #镜像作者信息</span><br><span class="line"></span><br><span class="line">#设置root用户为后续命令的执行者</span><br><span class="line">USER root</span><br><span class="line"></span><br><span class="line">#执行操作</span><br><span class="line">RUN apt-get update</span><br><span class="line">RUN apt-get install -y nginx</span><br><span class="line"></span><br><span class="line">#使用&amp;&amp;拼接命令</span><br><span class="line">RUN touch test.txt &amp;&amp; echo &#39;test&#39; &gt;&gt; test.txt</span><br><span class="line"></span><br><span class="line">#对外暴露端口</span><br><span class="line">EXPOSE 80 8080 9000</span><br><span class="line"></span><br><span class="line">#添加文件</span><br><span class="line">ADD abc.txt &#x2F;opt</span><br><span class="line">#添加网络文件</span><br><span class="line">ADD http:&#x2F;&#x2F;xxx &#x2F;opt</span><br><span class="line"></span><br><span class="line">#设置环境变量</span><br><span class="line">ENV WEB_PORT&#x3D;80</span><br><span class="line"></span><br><span class="line">#设置工作目录</span><br><span class="line">WORKDIR &#x2F;opt&#x2F;</span><br><span class="line"></span><br><span class="line">#设置卷</span><br><span class="line">VOLUME [&quot;&#x2F;data&quot;, &quot;&#x2F;var&#x2F;www&quot;]</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2016/02/26/2016-02-26-learn-docker/" data-id="ckzihch27000i939ke9fu98dg" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Docker/" rel="tag">Docker</a></li></ul>

    </footer>
  </div>
  
</article>
 


  
    <article id="post-2016-01-22-da-jian-shi-pin-bo-fang-fu-wu" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/01/22/2016-01-22-da-jian-shi-pin-bo-fang-fu-wu/" class="article-date">
  <time datetime="2016-01-22T09:01:46.000Z" itemprop="datePublished">2016-01-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/01/22/2016-01-22-da-jian-shi-pin-bo-fang-fu-wu/">搭建视频播放服务</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- Table of Contents -->
        
        <h4 id="安装必备软件"><a href="#安装必备软件" class="headerlink" title="安装必备软件"></a>安装必备软件</h4><ul>
<li>libx264<br>得到安装源代码 git clone git://git.videolan.org/x264.git<br>编译 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;configure --disable-yasm --enable-shared --enable-static</span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure></li>
</ul>
<p>把so包增加到系统中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo &#39;&#x2F;usr&#x2F;local&#x2F;lib&#x2F;&#39; &gt;&gt; &#x2F;etc&#x2F;ld.so.conf</span><br><span class="line">ldconfig</span><br></pre></td></tr></table></figure>

<ul>
<li>ffmpeg<br>下载 <a target="_blank" rel="noopener" href="http://ffmpeg.org/releases/ffmpeg-2.7.2.tar.bz2">http://ffmpeg.org/releases/ffmpeg-2.7.2.tar.bz2</a><br>编译 ./configure –disable-yasm</li>
</ul>
<h4 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h4><p>把mp4文件分割为多个ts文件和m3u8</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i 2001045000007.mp4 -c:v libx264 -c:a aac -strict -2 -f hls -hls_time 15 -hls_list_size 0 output.m3u8</span><br></pre></td></tr></table></figure>
<p>-hls_time n: 设置每片的长度，默认值为2。单位为秒</p>
<p>-hls_list_size n:设置播放列表保存的最多条目，设置为0会保存有所片信息，默认值为5</p>
<p>-hls_wrap n:设置多少片之后开始覆盖，如果设置为0则不会覆盖，默认值为0.这个选项能够避免在磁盘上存储过多的片，而且能够限制写入磁盘的最多的片的数量</p>
<p>-hls_start_number n:设置播放列表中sequence number的值为number，默认值为0</p>
<p>注意：播放列表的sequence number 对每个segment来说都必须是唯一的，而且它不能和片的文件名（当使用wrap选项时，文件名有可能会重复使用）混淆</p>
<p>生成的m3u8文件内容如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">cat output.m3u8</span><br><span class="line">#EXTM3U</span><br><span class="line">#EXT-X-VERSION:3</span><br><span class="line">#EXT-X-TARGETDURATION:22</span><br><span class="line">#EXT-X-MEDIA-SEQUENCE:0</span><br><span class="line">#EXTINF:21.050000,</span><br><span class="line">output0.ts</span><br><span class="line">#EXTINF:11.000000,</span><br><span class="line">output1.ts</span><br><span class="line">#EXTINF:13.500000,</span><br><span class="line">output2.ts</span><br><span class="line">#EXTINF:14.500000,</span><br><span class="line">output3.ts</span><br><span class="line">#EXTINF:16.500000,</span><br><span class="line">output4.ts</span><br><span class="line">#EXTINF:19.600000,</span><br><span class="line">output5.ts</span><br><span class="line">#EXTINF:8.900000,</span><br><span class="line">output6.ts</span><br><span class="line">#EXTINF:14.950000,</span><br><span class="line">output7.ts</span><br><span class="line">#EXTINF:15.050000,</span><br><span class="line">output8.ts</span><br><span class="line">#EXTINF:15.600000,</span><br><span class="line">output9.ts</span><br><span class="line">#EXTINF:15.750000,</span><br><span class="line">output10.ts</span><br><span class="line">#EXTINF:14.000000,</span><br><span class="line">output11.ts</span><br><span class="line">#EXTINF:14.700000,</span><br><span class="line">output12.ts</span><br><span class="line">#EXTINF:15.350000,</span><br><span class="line">output13.ts</span><br><span class="line">#EXTINF:15.000000,</span><br><span class="line">output14.ts</span><br><span class="line">#EXTINF:10.600000,</span><br><span class="line">output15.ts</span><br><span class="line">#EXT-X-ENDLIST</span><br></pre></td></tr></table></figure>
<p>搭建hls播放服务</p>
<ul>
<li>参考《做自己的m3u8点播系统使用HTTP Live Streaming(HLS技术）》</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2016/01/22/2016-01-22-da-jian-shi-pin-bo-fang-fu-wu/" data-id="ckzihch27000g939khnwe6zqg" class="article-share-link">分享</a>
      
      
      
    </footer>
  </div>
  
</article>
 


  
    <article id="post-2016-01-08-wo-de-railskai-fa-zong-jie" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/01/08/2016-01-08-wo-de-railskai-fa-zong-jie/" class="article-date">
  <time datetime="2016-01-08T03:43:50.000Z" itemprop="datePublished">2016-01-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/01/08/2016-01-08-wo-de-railskai-fa-zong-jie/">我的Rails开发总结</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- Table of Contents -->
        
        <p>[TOC]</p>
<h1 id="常用Gem列表"><a href="#常用Gem列表" class="headerlink" title="常用Gem列表"></a>常用Gem列表</h1><h3 id="Rails-Auth"><a href="#Rails-Auth" class="headerlink" title="Rails Auth"></a>Rails Auth</h3><ul>
<li><p>devise 验证</p>
</li>
<li><p>cancancan 权限控制</p>
</li>
</ul>
<h3 id="Rails-Frontend"><a href="#Rails-Frontend" class="headerlink" title="Rails Frontend"></a>Rails Frontend</h3><ul>
<li>kaminari 分页控件</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@users &#x3D; User.all.page(1).per_page(25)</span><br><span class="line"></span><br><span class="line">currentPage: @users.current_page,</span><br><span class="line">totalPages: @users.total_pages,</span><br><span class="line">totalRows: @users.total_count,</span><br><span class="line">hasNextPage: @users.next_page,</span><br><span class="line">hasPreviousPage: @users.prev_page</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>SimpleForm 表单</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">需要执行rails generate simple_form:install --bootstrap</span><br></pre></td></tr></table></figure>

<ul>
<li>Popupload 图片上传</li>
<li>carrierwave-upyun 图片上传</li>
<li>mini_magick</li>
<li>carrierwave</li>
<li>carrierwave-meta</li>
<li>rest-client</li>
<li>mime-types</li>
<li>uuidtools</li>
</ul>
<h3 id="Rails-Test-Drive"><a href="#Rails-Test-Drive" class="headerlink" title="Rails Test Drive"></a>Rails Test Drive</h3><ul>
<li>ffaker 快速生成测试数据</li>
</ul>
<h3 id="Rails-Helper"><a href="#Rails-Helper" class="headerlink" title="Rails Helper"></a>Rails Helper</h3><ul>
<li>settingslogic</li>
<li>magic_encoding</li>
<li><a target="_blank" rel="noopener" href="https://github.com/basecamp/local_time">local_time</a></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%&#x3D; local_time(comment.created_at) %&gt;</span><br></pre></td></tr></table></figure>


<ul>
<li>rails-i18n</li>
<li><a target="_blank" rel="noopener" href="https://github.com/Macrow/rails_kindeditor">rails_kindeditor</a></li>
</ul>
<h3 id="Ruby-General"><a href="#Ruby-General" class="headerlink" title="Ruby General"></a>Ruby General</h3><ul>
<li><a target="_blank" rel="noopener" href="http://pry.github.com/">pry</a></li>
</ul>
<h4 id="CSS中引用assets中的图片"><a href="#CSS中引用assets中的图片" class="headerlink" title="CSS中引用assets中的图片"></a>CSS中引用assets中的图片</h4><ol>
<li>首先必须是scss或sass</li>
<li>image-url(source) –&gt; assets/images/sources</li>
</ol>
<h4 id="Rails中格式化时间"><a href="#Rails中格式化时间" class="headerlink" title="Rails中格式化时间"></a>Rails中格式化时间</h4><ol>
<li>Add gem ‘local_time’ to your Gemfile.</li>
<li>Run bundle install.</li>
<li>Add //= require local_time to your JavaScript manifest file (usually found at app/assets/javascripts/application.js).</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;%&#x3D; h local_time(notice.created_at, &#39;%Y-%M-%d&#39;) %&gt;</span><br><span class="line">&lt;%&#x3D; local_time_ago(time) %&gt;</span><br></pre></td></tr></table></figure>

<h4 id="使用Kindeditor"><a href="#使用Kindeditor" class="headerlink" title="使用Kindeditor"></a>使用Kindeditor</h4><p>1、Gem ‘rails_kindeditor’<br>2、参考 <a target="_blank" rel="noopener" href="https://github.com/Macrow/rails_kindeditor">rails_kindeditor</a></p>
<h4 id="好用的bootstrap插件"><a href="#好用的bootstrap插件" class="headerlink" title="好用的bootstrap插件"></a>好用的bootstrap插件</h4><ol>
<li><a target="_blank" rel="noopener" href="http://silviomoreto.github.io/bootstrap-select/">bootstrap-select</a></li>
<li><a target="_blank" rel="noopener" href="http://markusslima.github.io/bootstrap-filestyle/">bootstrap-filestyle</a></li>
</ol>
<h3 id="Jquery插件"><a href="#Jquery插件" class="headerlink" title="Jquery插件"></a>Jquery插件</h3><ol>
<li>全屏遮罩 <a target="_blank" rel="noopener" href="http://jquery.malsup.com/block/">blcokUI</a></li>
<li>大图预览 <a target="_blank" rel="noopener" href="http://lokeshdhakar.com/projects/lightbox2/">lightbox</a></li>
<li>图片滚动 <a target="_blank" rel="noopener" href="http://jquery.malsup.com/cycle2/">cycle2</a></li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2016/01/08/2016-01-08-wo-de-railskai-fa-zong-jie/" data-id="ckzihch26000e939kgcve69nz" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Rails-%E5%BC%80%E5%8F%91/" rel="tag">Rails, 开发</a></li></ul>

    </footer>
  </div>
  
</article>
 


  
    <article id="post-2015-11-30-develop-new-app-step" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/11/30/2015-11-30-develop-new-app-step/" class="article-date">
  <time datetime="2015-11-30T03:00:10.000Z" itemprop="datePublished">2015-11-30</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/11/30/2015-11-30-develop-new-app-step/">开发APP的步骤</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- Table of Contents -->
        
        <h5 id="1、Android签名文件、包名、签名字符串"><a href="#1、Android签名文件、包名、签名字符串" class="headerlink" title="1、Android签名文件、包名、签名字符串"></a>1、Android签名文件、包名、签名字符串</h5><h5 id="2、IOS签名证书、包名"><a href="#2、IOS签名证书、包名" class="headerlink" title="2、IOS签名证书、包名"></a>2、IOS签名证书、包名</h5><h5 id="3、应用图标，16，28，32，64，80，100，108，120，512"><a href="#3、应用图标，16，28，32，64，80，100，108，120，512" class="headerlink" title="3、应用图标，16，28，32，64，80，100，108，120，512"></a>3、应用图标，16，28，32，64，80，100，108，120，512</h5><h5 id="4、应用截图-5张，含首页、关于我们、商品详情、支付"><a href="#4、应用截图-5张，含首页、关于我们、商品详情、支付" class="headerlink" title="4、应用截图 5张，含首页、关于我们、商品详情、支付"></a>4、应用截图 5张，含首页、关于我们、商品详情、支付</h5><h5 id="5、第三方应用注册申请"><a href="#5、第三方应用注册申请" class="headerlink" title="5、第三方应用注册申请"></a>5、第三方应用注册申请</h5><ul>
<li><p>微信</p>
</li>
<li><p>微博</p>
<p>  微博需要应用简介图片<br>  微博上线前必须要有应用的下载地址（IOS必须在Appstore上线）</p>
</li>
<li><p>QQ</p>
<p>  Android 版本申请上线就会发布到 应用宝 市场</p>
</li>
<li><p>友盟</p>
</li>
</ul>
<h5 id="6、微信支付"><a href="#6、微信支付" class="headerlink" title="6、微信支付"></a>6、微信支付</h5><ul>
<li>签约资料准备</li>
<li>商户认证</li>
<li>API安全密钥设置（需要安装操作证书）</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2015/11/30/2015-11-30-develop-new-app-step/" data-id="ckzihch24000a939kcbxie0y3" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%BC%80%E5%8F%91/" rel="tag">开发</a></li></ul>

    </footer>
  </div>
  
</article>
 


  
    <article id="post-2015-03-05-mysql5-dot-5an-zhuang-yu-pei-zhi-fang-fa" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/03/05/2015-03-05-mysql5-dot-5an-zhuang-yu-pei-zhi-fang-fa/" class="article-date">
  <time datetime="2015-03-05T07:05:31.000Z" itemprop="datePublished">2015-03-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/03/05/2015-03-05-mysql5-dot-5an-zhuang-yu-pei-zhi-fang-fa/">Mysql5.5安装与配置方法</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- Table of Contents -->
        
        <p>最新的Mysql5.5的源码安装已经不能再用configure的方式了，改成了cmake的编译方式，本文主要用于学习和记录mysql的基本安装方法。</p>
<h2 id="1、下载源码"><a href="#1、下载源码" class="headerlink" title="1、下载源码"></a>1、下载源码</h2><p>下载源码可以到mysql官网上下载，不过需要注意的是，一定要选择Source Code的方式，下载下来的文件为mysql-5.5.32.tar.gz</p>
<h2 id="2、编译前的准备工作"><a href="#2、编译前的准备工作" class="headerlink" title="2、编译前的准备工作"></a>2、编译前的准备工作</h2><p>编译前需要为系统安装一些其他工具支持，包括cmake,bison,gcc-c++,ncurses,automake,autoconf等</p>
<p>添加mysql用户和组</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">groupadd mysql</span><br><span class="line">useradd -g mysql mysql -s &#x2F;sbin&#x2F;nologin</span><br></pre></td></tr></table></figure>

<h2 id="3、编译"><a href="#3、编译" class="headerlink" title="3、编译"></a>3、编译</h2><p>编译参数可以参考<a target="_blank" rel="noopener" href="http://dev.mysql.com/doc/refman/5.5/en/source-configuration-options.html">文档</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cmake -DCMAKE_INSTALL_PREFIX&#x3D;&#x2F;usr&#x2F;local&#x2F;mysql -DMYSQL_DATADIR&#x3D;&#x2F;usr&#x2F;local&#x2F;mysql&#x2F;data -DWITH_INNOBASE_STORAGE_ENGINE&#x3D;1 -DMYSQL_TCP_PORT&#x3D;3306 -DMYSQL_UNIX_ADDR&#x3D;&#x2F;tmp&#x2F;mysql.sock -DMYSQL_USER&#x3D;mysql -DWITH_DEBUG&#x3D;0 -DDEFAULT_CHAESET&#x3D;utf8 -DDEFAULT_COLLATION&#x3D;utf8_general_ci -WITH_EXTRA_CHARSETS:STRING&#x3D;utf8,gbk</span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>

<h2 id="4、启动与停止"><a href="#4、启动与停止" class="headerlink" title="4、启动与停止"></a>4、启动与停止</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chown -R mysql:mysql &#x2F;usr&#x2F;local&#x2F;mysql</span><br><span class="line">scripts&#x2F;mysql_install_db --user&#x3D;mysql --basedir&#x3D;&#x2F;usr&#x2F;local&#x2F;mysql --datadir&#x3D;&#x2F;usr&#x2F;local&#x2F;mysql&#x2F;data</span><br></pre></td></tr></table></figure>

<p>写一个启动停止的脚本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">mysql_port&#x3D;3306</span><br><span class="line">mysql_username&#x3D;&quot;root&quot;</span><br><span class="line">mysql_passwd&#x3D;&quot;123456&quot;</span><br><span class="line">mysql_basedir&#x3D;&quot;&#x2F;usr&#x2F;local&#x2F;mysql&quot;</span><br><span class="line">mysql_conf&#x3D;&quot;&#x2F;usr&#x2F;local&#x2F;mysql&#x2F;conf&quot;</span><br><span class="line"></span><br><span class="line">function_start_mysql()</span><br><span class="line">&#123;</span><br><span class="line">	printf &quot;Starting Mysql...\n&quot;</span><br><span class="line">	&#x2F;bin&#x2F;sh $&#123;mysql_basedir&#125;&#x2F;bin&#x2F;mysqld_safe --defaults-file&#x3D;$&#123;mysql_conf&#125;f&#x2F;my.cnf 2&gt;&amp;1 &#x2F;dev&#x2F;null &amp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function_stop_mysql()</span><br><span class="line">&#123;</span><br><span class="line">	printf &quot;Stop Mysql...\n&quot;</span><br><span class="line">	$&#123;mysql_basedir&#125;&#x2F;bin&#x2F;mysqladmin -u $&#123;mysql_username&#125; -p$&#123;mysql_passwd&#125; -S &#x2F;tmp&#x2F;mysql.sock shutdown</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function_restart_mysql()</span><br><span class="line">&#123;</span><br><span class="line">	printf &quot;Restarting Mysql...\n&quot;</span><br><span class="line">	function_stop_mysql</span><br><span class="line">	sleep 5</span><br><span class="line">	function_start_mysql</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if [ &quot;$1&quot; &#x3D;&#x3D; &quot;start&quot; ]; then</span><br><span class="line">	function_start_mysql</span><br><span class="line">elif [ &quot;$1&quot; &#x3D;&#x3D; &quot;stop&quot; ]; then</span><br><span class="line">	function_stop_mysql</span><br><span class="line">elif [ &quot;$1&quot; &#x3D;&#x3D; &quot;restart&quot; ]; then</span><br><span class="line">	function_restart_mysql</span><br><span class="line">else</span><br><span class="line">	printf &quot;Usage: start|stop|restart\n&quot;</span><br><span class="line">fi</span><br><span class="line"></span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2015/03/05/2015-03-05-mysql5-dot-5an-zhuang-yu-pei-zhi-fang-fa/" data-id="ckzihch26000c939k98mq9b33" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mysql/" rel="tag">mysql</a></li></ul>

    </footer>
  </div>
  
</article>
 


  


  <nav id="page-nav">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">下一页&amp;raquo;</a>
  </nav>
</section>
           
    <aside id="sidebar">
  
    
  <div class="widget-wrap">
     
        <h3 class="follow-title ">Follow me</h3>
     
    <div class="widget follow">
      
              <a class="github" aria-hidden="true" href="https://github.com/karidyang" target="_blank" title="Github"></a>
      
      
            <a class="weibo" aria-hidden="true"  href="http://weibo.com/karidyang" target="_blank" title="微博"></a>
      
      
      
            <a class="email" aria-hidden="true"  href="mailto:karidyang@gmail.com" target="_blank" title="邮箱"></a>
      
    </div>
  </div>


  
    
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title tagcloud">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/Docker/" style="font-size: 14px;">Docker</a> <a href="/tags/Java-Spock/" style="font-size: 14px;">Java,Spock</a> <a href="/tags/Jetty/" style="font-size: 14px;">Jetty</a> <a href="/tags/Rails-%E5%BC%80%E5%8F%91/" style="font-size: 14px;">Rails, 开发</a> <a href="/tags/java/" style="font-size: 14px;">java</a> <a href="/tags/java-weixin/" style="font-size: 14px;">java, weixin</a> <a href="/tags/mysql/" style="font-size: 14px;">mysql</a> <a href="/tags/nginx/" style="font-size: 14px;">nginx</a> <a href="/tags/rails/" style="font-size: 25px;">rails</a> <a href="/tags/spring-nacos-sentinel/" style="font-size: 14px;">spring, nacos, sentinel</a> <a href="/tags/varnish/" style="font-size: 14px;">varnish</a> <a href="/tags/%E5%BC%80%E5%8F%91/" style="font-size: 14px;">开发</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title recent-posts">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2022/02/11/Spock%E5%AE%9E%E8%B7%B5/">Spock实践</a>
          </li>
        
          <li>
            <a href="/2021/04/23/uni-app-%E5%8C%85%E8%A3%85H5%E9%A1%B9%E7%9B%AE%E9%9B%86%E6%88%90%E5%BE%AE%E4%BF%A1%E7%99%BB%E5%BD%95%E6%94%AF%E4%BB%98%E5%92%8C%E5%88%86%E4%BA%AB/">uni-app 包装H5项目集成微信登录支付和分享</a>
          </li>
        
          <li>
            <a href="/2021/04/23/SpringCloud-Gateway-nacos-sentinel%E5%85%A5%E9%97%A8/">SpringCloud+Gateway+nacos+sentinel入门</a>
          </li>
        
          <li>
            <a href="/2021/04/23/%E4%BD%BF%E7%94%A8Ganache%E5%BC%80%E5%8F%91%E4%BB%A5%E5%A4%AA%E5%9D%8A%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/">使用Ganache开发以太坊智能合约</a>
          </li>
        
          <li>
            <a href="/2021/04/22/2021%E5%AD%A6%E4%B9%A0%E8%AE%A1%E5%88%92/">2021学习计划</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title archive">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">二月 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">四月 2021</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">二月 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">一月 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">十一月 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/03/">三月 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/10/">十月 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/09/">九月 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/08/">八月 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/06/">六月 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/03/">三月 2014</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/01/">一月 2014</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>


  
    
<div class="widget-wrap">
    <h3 class="widget-title">友情链接</h3>
    <div class="widget">
        <ul>
            
            <li>
                <a target="_blank" rel="noopener" href="https://huangbaihua.gitee.io">BAIHUA&#39;s blog</a>
            </li>
            
        </ul>
    </div>
</div>

  
    <!--微信公众号二维码-->

  <div class="widget-wrap">
    <h3 class="follow-title ">微信公众号</h3>
    <div class="widget wechat-widget">
        <img src="http://blog-img.taoguli.com/img/qrcode_for_gh_fb1e6b53a000_258.jpg" alt="扫码关注" width="250"/>
    </div>
  </div>


  
</aside>

      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-left">
      &copy; 2014 - 2022 karidyang&nbsp;|&nbsp;
      主题 <a href="https://github.com/giscafer/hexo-theme-cafe/" target="_blank">Cafe</a>
    </div>
     <div id="footer-right">
      联系方式&nbsp;|&nbsp;karidyang@gmail.com
    </div>
  </div>
</footer>
 
<script src="/jquery/jquery.min.js"></script>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">首页</a>
  
    <a href="/archives" class="mobile-nav-link">归档</a>
  
    <a href="/about" class="mobile-nav-link">关于</a>
  
</nav>
    <img class="back-to-top-btn" src="/images/fly-to-top.png"/>
<script>
// Elevator script included on the page, already.
window.onload = function() {
  var elevator = new Elevator({
    selector:'.back-to-top-btn',
    element: document.querySelector('.back-to-top-btn'),
    duration: 1000 // milliseconds
  });
}
</script>
      

  
    <script>
      var cloudTieConfig = {
        url: document.location.href, 
        sourceId: "",
        productKey: "e2fb4051c49842688ce669e634bc983f",
        target: "cloud-tie-wrapper"
      };
    </script>
    <script src="https://img1.ws.126.net/f2e/tie/yun/sdk/loader.js"></script>
    

  







<!-- author:forvoid begin -->
<!-- author:forvoid begin -->

<!-- author:forvoid end -->

<!-- author:forvoid end -->


  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      })
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      })
    </script>
    <script type="text/javascript" src="https://cdn.rawgit.com/mathjax/MathJax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


 
<script src="/js/is.js"></script>



  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>


<script src="/js/elevator.js"></script>

  </div>
</body>
</html>